<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up Form | Deb8er</title>
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="assets/form.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon1.png" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
      <!--            Navigation Bar                  -->

      <nav class="navbar">
        <div class="navbar-container">
          <a href="#landing-page" class="logo">
            <img src="assets/images/Deb9erfinallogo.png" alt="">
          </a>
      
          <!-- Hamburger -->
          <div class="nav-toggle" id="navToggle">
            <i class="fa-solid fa-bars"></i>
          </div>
      
          <ul class="nav-links" id="navLinks">
            <li><a href="index.html">Home</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="conferences.html">Conferences</a></li>
            <li><a href="verification.html">Verification</a></li>
            <li><a href="team.html">Team</a></li>
            <li><a href="form.html" class="join-btn">Join Us</a></li>
          </ul>
        </div>
      </nav>
      <section class="join-section" id="join">
        <h2 class="section-title">
            Join a <span class="span1">Deb</span><span class="span2">8</span>er MUN
        </h2>
    
        <div class="event-type-selector">
            <label class="event-option">
                <input type="radio" name="eventType" value="mun" checked>
                <span>MUN Conference</span>
            </label>
    
            <label class="event-option">
                <input type="radio" name="eventType" value="debate">
                <span>Debate Conference</span>
            </label>
        </div>
    
        <form class="join-form" id="munForm">
            <div class="form-group">
                <label>Full Legal Name</label>
                <input type="text" name="fullName" required placeholder="Your full legal name">
            </div>
    
            <div class="form-group">
                <label>Nick Name</label>
                <input type="text" name="nickName" required placeholder="Name you would like to use (If none, fill in first name)">
            </div>
    
            <div class="form-group">
                <label>Email Address</label>
                <input type="email" name="email" required placeholder="you@example.com">
            </div>
    
            <div class="form-group">
                <label>Age</label>
                <input type="number" name="age" min="10" max="20" required>
            </div>
    
            <div class="form-group">
              <label>Country</label>
              <input type="text" id="countryInput" list="countryList" name="country" placeholder="Start typing your residential country..." autocomplete="off" required />
              <datalist id="countryList"></datalist> </div>
    
            <div class="timezone-message" id="timezoneMessage"></div>
    
            <div class="form-group mun-only">
              <label>Country You Prefer to Represent (Portfolio)</label>
              <input 
                  type="text" 
                  name="preferredCountry" 
                  list="countryList" 
                  placeholder="Country you want to represent (Portfolio)" 
                  autocomplete="off"
              />
              </div>
    
            <div class="form-group committee-group mun-only">
                <label>
                    Committee
                    <span class="info-trigger">
                        <i class="fas fa-info-circle"></i>
                        <span class="tooltip-box">
                            Although you select a committee, it is not guaranteed.
                        </span>
                    </span>
                </label>
    
                <div class="custom-dropdown" data-name="committee">
                    <div class="dropdown-selected">
                        <span class="selected-text">Select a committee</span>
                        <i class="fa-solid fa-chevron-down"></i>
                    </div>
                    <div class="dropdown-options">
                        <div class="dropdown-option" data-value="">Select a committee</div>
                        <div class="dropdown-option" data-value="UNGA">UNGA</div>
                        <div class="dropdown-option" data-value="DISEC">DISEC</div>
                        <div class="dropdown-option" data-value="UNICEF">UNICEF</div>
                        <div class="dropdown-option" data-value="UNHRC">UNHRC</div>
                        <div class="dropdown-option" data-value="UNSC">UNSC</div>
                    </div>
                    <input type="hidden" name="committee" value="">
                </div>
            </div> 
    
            <div class="form-group">
                <label class="label-with-info">
                    Debate Region
                    <span class="info-trigger">
                        <i class="fas fa-info-circle"></i>
                        <span class="tooltip-box">
                            You may still select other regions if available.
                        </span>
                    </span>
                </label>
    
                <div class="custom-dropdown" data-name="region"> <div class="dropdown-selected">
                        <span class="selected-text">Select region</span>
                        <i class="fa-solid fa-chevron-down"></i>
                    </div>
                    <div class="dropdown-options">
                        <div class="dropdown-option" data-value="">Select region</div>
                        <div class="dropdown-option" data-value="asia">Asian Debate</div>
                        <div class="dropdown-option" data-value="america">American Debate</div>
                        <div class="dropdown-option" data-value="europe">European Debate</div>
                        <div class="dropdown-option" data-value="africa">African-Oceania Debate</div>
                    </div>
                    <input type="hidden" name="region" value=""> 
                </div>
            </div> 
    
            <div class="form-checkbox">
                <input type="checkbox" id="timezoneAgree" required>
                <label for="timezoneAgree">
                    I understand this debate may take place outside of my local timezone.
                </label>
            </div>
    
            <button type="submit" class="join-btn full">Submit Application</button>
        </form>
        <div id="formSuccess" class="success-card" style="display: none;">
          <i class="fas fa-check-circle"></i>
          <h3>Application Received!</h3>
          <p>Thank you for applying to Deb8er. We have received your information and will contact you via email soon.</p>
          <div class="success-sub">A confirmation message has been sent to your inbox.</div>
          <a href="index.html" class="join-btn">Back to Home</a>
      </div>
    </section>
      <script src="script.js"></script>
    <!-- Include D3.js -->
<script src="https://d3js.org/d3.v7.min.js"></script>
<!-- Include TopoJSON for world map -->
<script src="https://d3js.org/topojson.v3.min.js"></script>

<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

<!-- Moment.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>

<!-- Moment Timezone -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.43/moment-timezone-with-data.min.js"></script>
<script>
  /* ================= CUSTOM DROPDOWN ================= */
  document.querySelectorAll(".custom-dropdown").forEach((dropdown) => {
    const selected = dropdown.querySelector(".dropdown-selected");
    const selectedText = dropdown.querySelector(".selected-text");
    const options = dropdown.querySelectorAll(".dropdown-option");
    const hiddenInput = dropdown.querySelector('input[type="hidden"]');

    selected.addEventListener("click", () => {
      dropdown.classList.toggle("active");
      document.querySelectorAll(".custom-dropdown").forEach((other) => {
        if (other !== dropdown) other.classList.remove("active");
      });
    });

    options.forEach((option) => {
      option.addEventListener("click", () => {
        const value = option.dataset.value;
        const text = option.textContent;

        selectedText.textContent = text;
        if (hiddenInput) {
          hiddenInput.value = value;
          // Trigger a change event so the timezone logic sees the update
          hiddenInput.dispatchEvent(new Event("change", { bubbles: true }));
        }

        options.forEach((opt) => opt.classList.remove("selected"));
        option.classList.add("selected");
        dropdown.classList.remove("active");
      });
    });

    document.addEventListener("click", (e) => {
      if (!dropdown.contains(e.target)) dropdown.classList.remove("active");
    });
  });

  document.addEventListener("DOMContentLoaded", () => {
    /* ================= CORE ELEMENTS ================= */
    const eventRadios = document.querySelectorAll('input[name="eventType"]');
    const munOnly = document.querySelectorAll(".mun-only");
    const debateOnly = document.querySelectorAll(".debate-only");
    const title = document.querySelector(".section-title");
    const countryInput = document.getElementById("countryInput");
    const countryList = document.getElementById("countryList");

    // Selecting by name because ID was missing in HTML
    const regionHiddenInput = document.querySelector('input[name="region"]');
    const timezoneMessage = document.getElementById("timezoneMessage");
    const form = document.getElementById("munForm");
    const successBox = document.getElementById("formSuccess");

    let countryMap = {};
    let regionAutoSet = false;

    /* =========================================================
       REGION TIME SLOTS (OFFICIAL TIME = IST / Asia-Kolkata)
       IST = UTC+5:30
    ========================================================= */
    const REGION_SLOTS = {
      mun: {
        asia: {
          label: "Asia",
          timezone: "Asia/Kolkata",
          date: "2026-03-07",
          start: "14:00",
          end: "19:00"
        },
        europe: {
          label: "Europe",
          timezone: "Asia/Kolkata",
          date: "2026-03-07",
          start: "19:30",
          end: "00:30" // crosses midnight
        },
        america: {
          label: "Americas",
          timezone: "Asia/Kolkata",
          date: "2026-03-07",
          start: "19:30",
          end: "00:30" // crosses midnight
        },
        africa: {
          label: "Africa–Oceania",
          timezone: "Asia/Kolkata",
          date: "2026-03-07",
          start: "12:00",
          end: "17:00"
        }
      },

      debate: {
        asia: {
          label: "Asia",
          timezone: "Asia/Kolkata",
          date: "2026-02-07",
          start: "14:30",
          end: "17:30"
        },
        europe: {
          label: "Europe",
          timezone: "Asia/Kolkata",
          date: "2026-02-06",
          start: "20:30",
          end: "23:30"
        },
        america: {
          label: "Americas",
          timezone: "Asia/Kolkata",
          date: "2026-02-07",
          start: "03:30",
          end: "06:30"
        },
        africa: {
          label: "Africa–Oceania",
          timezone: "Asia/Kolkata",
          date: "2026-02-09",
          start: "11:00",
          end: "14:00"
        }
      }
    };

    function getEventType() {
      return document.querySelector('input[name="eventType"]:checked')?.value || "mun";
    }

    function updateEventType(type) {
      if (type === "mun") {
        munOnly.forEach((el) => (el.style.display = "flex"));
        debateOnly.forEach((el) => (el.style.display = "none"));
        title.innerHTML = `Join a <span class="span1">Deb</span><span class="span2">8</span>er MUN`;
      } else {
        munOnly.forEach((el) => (el.style.display = "none"));
        debateOnly.forEach((el) => (el.style.display = "flex"));
        title.innerHTML = `Join a <span class="span1">Deb</span><span class="span2">8</span>er Debate`;
      }
    }

    function getBestTimezoneForCountry(countryCode) {
      const zones = moment.tz.zonesForCountry(countryCode, true);
      if (!zones || zones.length === 0) return null;
      zones.sort((a, b) => (b.population || 0) - (a.population || 0));
      return zones[0].name;
    }

    function autoSelectRegionByCountry(countryCode) {
      const tz = getBestTimezoneForCountry(countryCode);
      if (!tz || regionAutoSet) return;

      let suggested = "asia";
      if (tz.startsWith("Europe")) suggested = "europe";
      else if (tz.startsWith("America")) suggested = "america";
      else if (tz.startsWith("Africa")) suggested = "africa";
      else if (tz.startsWith("Australia") || tz.startsWith("Pacific")) suggested = "africa";

      if (regionHiddenInput) {
        regionHiddenInput.value = suggested;
        const customDropdown = regionHiddenInput.closest(".custom-dropdown");
        if (customDropdown) {
          const selectedText = customDropdown.querySelector(".selected-text");
          const option = customDropdown.querySelector(
            `.dropdown-option[data-value="${suggested}"]`
          );
          if (option && selectedText) selectedText.textContent = option.textContent;
        }
        updateLocalTime();
      }
    }

    /* ================= TIME DISPLAY ================= */
    function updateLocalTime() {
      const countryName = countryInput.value.trim();
      const regionKey = regionHiddenInput ? regionHiddenInput.value : "";
      const eventType = getEventType();

      // Hide if country invalid or region not selected
      if (!countryMap[countryName] || !regionKey || !REGION_SLOTS[eventType][regionKey]) {
        timezoneMessage.style.display = "none";
        return;
      }

      const userTZ = getBestTimezoneForCountry(countryMap[countryName]);
      if (!userTZ) {
        timezoneMessage.style.display = "none";
        return;
      }

      const region = REGION_SLOTS[eventType][regionKey];

      // Official time is IST (Asia/Kolkata)
      const start = moment.tz(`${region.date} ${region.start}`, "YYYY-MM-DD HH:mm", region.timezone);
      let end = moment.tz(`${region.date} ${region.end}`, "YYYY-MM-DD HH:mm", region.timezone);

      // Fix sessions crossing midnight
      if (end.isSameOrBefore(start)) end.add(1, "day");

      // Convert to user's timezone
      const localStart = start.clone().tz(userTZ);
      const localEnd = end.clone().tz(userTZ);

      timezoneMessage.innerHTML = `
        <strong>${region.label} ${eventType.toUpperCase()} Session</strong><br>
        Official time: ${start.format("MMM D, YYYY hh:mm A")} – ${end.format("MMM D, YYYY hh:mm A")} (IST)<br>
        <span style="color:#22d3ee;">
          Your local time: ${localStart.format("MMM D, YYYY hh:mm A")} – ${localEnd.format("MMM D, YYYY hh:mm A")} (${userTZ})
        </span>
      `;
      timezoneMessage.style.display = "block";
    }

    /* ================= EVENTS ================= */
    eventRadios.forEach((radio) => {
      radio.addEventListener("change", () => {
        updateEventType(radio.value);
        regionAutoSet = false;
        updateLocalTime();
      });
    });

    countryInput.addEventListener("input", () => {
      const code = countryMap[countryInput.value.trim()];
      if (!code) {
        timezoneMessage.style.display = "none";
        return;
      }
      autoSelectRegionByCountry(code);
      updateLocalTime();
    });

    if (regionHiddenInput) {
      regionHiddenInput.addEventListener("change", () => {
        regionAutoSet = true;
        updateLocalTime();
      });
    }

    /* ================= FETCH COUNTRIES ================= */
    fetch("https://restcountries.com/v3.1/all?fields=name,cca2")
      .then((res) => res.json())
      .then((data) => {
        data.sort((a, b) => a.name.common.localeCompare(b.name.common));
        data.forEach((c) => {
          countryMap[c.name.common] = c.cca2;
          const opt = document.createElement("option");
          opt.value = c.name.common;
          countryList.appendChild(opt);
        });
        updateLocalTime();
      });

    /* ================= FORM SUBMISSION ================= */
    const GOOGLE_SHEET_URL =
      "https://script.google.com/macros/s/AKfycbyAM2mRfTYJQL5PPDw8_kryjYw72cTQfzoi23j3wKVgtd9chEFqoJqrGVsFjptvvk6r/exec";

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.innerText = "Processing...";
      submitBtn.disabled = true;

      try {
        const eventType = getEventType();
        const formData = new URLSearchParams();

        formData.append("eventType", eventType);
        formData.append("fullName", form.elements["fullName"].value);
        formData.append("nickName", form.elements["nickName"].value);
        formData.append("email", form.elements["email"].value);
        formData.append("age", form.elements["age"].value);
        formData.append("country", countryInput.value);
        formData.append("region", regionHiddenInput.value);

        if (eventType === "mun") {
          formData.append("preferredCountry", form.elements["preferredCountry"].value || "N/A");
          const committeeValue = form.querySelector('input[name="committee"]')?.value || "";
          formData.append("committee", committeeValue || "Not Selected");
        }

        await fetch(GOOGLE_SHEET_URL, {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: formData.toString(),
        });

        showSuccessState();
      } catch (err) {
        alert("Connection error. Please try again.");
        submitBtn.innerText = "Submit Application";
        submitBtn.disabled = false;
      }
    });

    function showSuccessState() {
      [form, document.querySelector(".event-type-selector"), title].forEach((el) => {
        if (el) el.style.setProperty("display", "none", "important");
      });
      if (successBox) {
        successBox.style.display = "block";
        successBox.style.opacity = "1";
        window.scrollTo({ top: document.getElementById("join").offsetTop, behavior: "smooth" });
      }
    }

    updateEventType("mun");
  });
</script>

  
  
</body>
</html>